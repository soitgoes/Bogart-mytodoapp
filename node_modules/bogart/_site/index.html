<html>
<head>
  <title>Bogart</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="/bogart/css/pygments/default.css" />
  <link rel="stylesheet" href="/bogart/css/bootstrap.min.css" />
  <link rel="stylesheet" href="/bogart/css/bootstrap-theme.min.css" />
</head>
<body>
  <nav class="navbar navbar-default" role="navigation">
    <div class="navbar-header">
      <a href="#" class="navbar-brand">Bogart</a>
    </div>
  
    <div class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li><a href="/bogart/api.html">API Docs</a></li>
        <li><a href="/bogart/tutorials.html">Tutorials</a></li>
      </ul>
    </div>
  </nav>

  <h1 id="quick_start">Quick Start</h1>

<p>Do you have node installed? If not, <a href="http://nodejs.org">install it</a> then lets get started.</p>

<p>Lets make our first Bogart app!</p>

<pre><code>mkdir hello-bogart
cd hello-bogart</code></pre>

<p>Create a <code>package.json</code> file in your <code>hello-bogart</code> directory.</p>

<pre><code>{
  &quot;name&quot;: &quot;hello-bogart&quot;,
  &quot;private&quot;: true,
  &quot;version&quot;: &quot;0.1.0&quot;
}</code></pre>

<p>Great, now lets install bogart.</p>

<pre><code>npm install bogart --save</code></pre>

<p>The <code>--save</code> flag tells npm to add the dependency to your <code>package.json</code>. Open <code>package.json</code> again and if everything worked, it should now look like this:</p>
<div class='highlight'><pre><code class='javascript'><span class='p'>{</span>
  <span class='s2'>&quot;name&quot;</span><span class='o'>:</span> <span class='s2'>&quot;hello-bogart&quot;</span><span class='p'>,</span>
  <span class='s2'>&quot;private&quot;</span><span class='o'>:</span> <span class='kc'>true</span><span class='p'>,</span>
  <span class='s2'>&quot;version&quot;</span><span class='o'>:</span> <span class='mf'>0.1</span><span class='p'>.</span><span class='mi'>0</span><span class='p'>,</span>
  <span class='s2'>&quot;dependencies&quot;</span><span class='o'>:</span> <span class='p'>{</span>
    <span class='s2'>&quot;bogart&quot;</span><span class='o'>:</span> <span class='s2'>&quot;~0.5.14&quot;</span>
  <span class='p'>}</span>
<span class='p'>}</span>
</code></pre></div>
<p>Also, a new directory, <code>node_modules</code>, was created by npm in your <code>hello-bogart</code> directory. The <code>node_modules</code> directory holds localized copies of dependencies declared in the <code>package.json</code>. If you want to update your dependencies later, you can do so by executing <code>npm update</code> in your <code>hello-bogart</code> directory.</p>

<p>You can verify that Bogart was installed as a package by executing <code>npm ls</code>.</p>

<p>Now, create an <code>app.js</code> file.</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>bogart</span> <span class='o'>=</span> <span class='nx'>require</span><span class='p'>(</span><span class='s1'>&#39;bogart&#39;</span><span class='p'>);</span>

<span class='kd'>var</span> <span class='nx'>router</span> <span class='o'>=</span> <span class='nx'>bogart</span><span class='p'>.</span><span class='nx'>router</span><span class='p'>();</span>
</code></pre></div>
<p>With an instance of <code>Router</code>, you can now add routes using the <code>get</code>, <code>post</code>, <code>put</code>, and <code>del</code> methods.</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>router</span><span class='p'>.</span><span class='nx'>get</span><span class='p'>(</span><span class='s1'>&#39;/&#39;</span><span class='p'>,</span> <span class='kd'>function</span> <span class='p'>(</span><span class='nx'>req</span><span class='p'>)</span> <span class='p'>{</span>
  <span class='k'>return</span> <span class='p'>{</span>
    <span class='nx'>status</span><span class='o'>:</span> <span class='mi'>200</span><span class='p'>,</span>
    <span class='nx'>headers</span><span class='o'>:</span> <span class='p'>{</span> <span class='s1'>&#39;content-type&#39;</span><span class='o'>:</span> <span class='s1'>&#39;text/plain&#39;</span> <span class='p'>},</span>
    <span class='nx'>body</span><span class='o'>:</span> <span class='s1'>&#39;Hello World&#39;</span>
  <span class='p'>};</span>
<span class='p'>});</span>
</code></pre></div>
<p>This adds a route handler responding to GET “/”. The result of the route is specified declaratively as a JSON object containing three properties: <code>status</code>, <code>headers</code>, and <code>body</code>.</p>

<p>The <code>status</code> property is the HTTP Status code to return.</p>

<p>The <code>body</code> may be a String, an Array, a Buffer, or a Stream.</p>

<p>The <code>headers</code> property is case-insensitive. <code>content-type</code> and <code>Content-Type</code> are equivalent; however, in Bogart, the lower-case variant is preferred (Who wants to hold down that shift key? Not this guy!).</p>

<p>What about this <code>req</code> parameter? That is the bogart <code>Request</code> object. It has useful information about the request for the route.</p>

<ul>
<li>method: HTTP method, lower-case.</li>

<li>version: Parsed HTTP Version. HTTP 1.1 will be parsed to [1,1] for example.</li>

<li>headers: Read-only map of header names and values. Header names are lower-case.</li>

<li>href: Full URL requested.</li>

<li>isXMLHttpRequest: Boolean indicating if the request was made via XHR.</li>

<li>nodeRequest: the raw node request object.</li>

<li>routeParams: An object containing the named route parameters.</li>

<li>params: Combines the route parameters, form parameters, and query string parameters. Precendence for conflicting names is resolved in the following order: route parameters -&gt; form parameters -&gt; query string parameters.</li>

<li>hostname: Host part of the URL ex: whiteboard-it.com</li>

<li>hostName: alias of hostname for those who prefer camel case to being consistent with location object.</li>

<li>host: Hostname and Port portion of the URL ex: whiteboard-it.com:8080</li>

<li>protocol: Protocol of the request including the final &#39;:&#39; ex: http:, https:</li>

<li>path: Initial &#39;/&#39; followed by the path of the URL without the querystring.</li>

<li>pathname: Initial &#39;/&#39; followed by the path of the URL.</li>

<li>search: Contains a &#39;?&#39; followed by the parameters of the URL.</li>
</ul>

<p>Don&#39;t worry, the URL will not be parsed until you call one of these methods so you incur no performance penalty if you do not access them.</p>

<p>Next, create and start the bogart app.</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>app</span> <span class='o'>=</span> <span class='nx'>bogart</span><span class='p'>.</span><span class='nx'>app</span><span class='p'>();</span>
<span class='nx'>app</span><span class='p'>.</span><span class='nx'>use</span><span class='p'>(</span><span class='nx'>router</span><span class='p'>);</span> <span class='c1'>// Add router to the app</span>
<span class='nx'>app</span><span class='p'>.</span><span class='nx'>start</span><span class='p'>();</span>
</code></pre></div>
<p>Note the <code>app.use(router)</code> call adds the router to the App chain. You can have as many routers as you want to isolate routes in a logical manner. <code>app.use</code> also allows you to add middelware.</p>

<p>Bogart middleware is in the form of a function that takes the next step in the chain and returns a function that takes a request and returns a response.</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>function</span> <span class='nx'>LogRequest</span><span class='p'>(</span><span class='nx'>next</span><span class='p'>)</span> <span class='p'>{</span>
  <span class='k'>return</span> <span class='kd'>function</span> <span class='p'>(</span><span class='nx'>req</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span><span class='s1'>&#39;Request&#39;</span><span class='p'>,</span> <span class='nx'>req</span><span class='p'>);</span>

    <span class='k'>return</span> <span class='nx'>next</span><span class='p'>(</span><span class='nx'>req</span><span class='p'>).</span><span class='nx'>then</span><span class='p'>(</span><span class='kd'>function</span> <span class='p'>(</span><span class='nx'>res</span><span class='p'>)</span> <span class='p'>{</span>
      <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span><span class='s1'>&#39;Response&#39;</span><span class='p'>,</span> <span class='nx'>res</span><span class='p'>);</span>
      <span class='k'>return</span> <span class='nx'>res</span><span class='p'>;</span>
    <span class='p'>});</span>
  <span class='p'>};</span>
<span class='p'>}</span>
</code></pre></div>
<p>First things first, Bogart embraces <a href="http://howtonode.org/promises">Promises</a> as a control-flow mechanism. The LogRequest middleware expects that what is returned from the call to <code>next(req)</code> will be a promise. This is a safe assumption in Bogart. If a non-promise is returned from a route, Bogart will wrap it in a Promise.</p>

<p>So where does this <code>next</code> parameter come from? Don&#39;t worry about it! Bogart figures it out. Let’s alter the previous code sample where we created the app and added the router to it.</p>
<div class='highlight'><pre><code class='javascript'>    <span class='kd'>var</span> <span class='nx'>app</span> <span class='o'>=</span> <span class='nx'>bogart</span><span class='p'>.</span><span class='nx'>app</span><span class='p'>();</span>
    <span class='nx'>app</span><span class='p'>.</span><span class='nx'>use</span><span class='p'>(</span><span class='nx'>LogRequest</span><span class='p'>)</span>
    <span class='nx'>app</span><span class='p'>.</span><span class='nx'>use</span><span class='p'>(</span><span class='nx'>router</span><span class='p'>);</span>

    <span class='nx'>app</span><span class='p'>.</span><span class='nx'>start</span><span class='p'>();</span>
</code></pre></div>
<p>Now run the server using <code>node app.js</code>. When you view it on <code>localhost:8080</code>, you should see messages in your terminal each time you refresh the page showing you the request and response objects.</p>

<p>The order in which the <code>app.use</code> statements are called is significant. You must call them in the order you want them to execute.</p>

<p>Also, bogart provides a middleware helper to make writing middleware a little nicer. Rewriting LogRequest using the helper looks like this:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>LogRequest</span> <span class='o'>=</span> <span class='nx'>bogart</span><span class='p'>.</span><span class='nx'>middleware</span><span class='p'>(</span><span class='kd'>function</span> <span class='p'>(</span><span class='nx'>req</span><span class='p'>,</span> <span class='nx'>next</span><span class='p'>)</span> <span class='p'>{</span>
  <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span><span class='s1'>&#39;Request&#39;</span><span class='p'>,</span> <span class='nx'>req</span><span class='p'>);</span>

  <span class='k'>return</span> <span class='nx'>next</span><span class='p'>(</span><span class='nx'>req</span><span class='p'>).</span><span class='nx'>then</span><span class='p'>(</span><span class='kd'>function</span> <span class='p'>(</span><span class='nx'>res</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span><span class='s1'>&#39;Response&#39;</span><span class='p'>,</span> <span class='nx'>res</span><span class='p'>);</span>
    <span class='k'>return</span> <span class='nx'>res</span><span class='p'>;</span>
  <span class='p'>});</span>
<span class='p'>});</span>
</code></pre></div>
<p>Note that the <code>next</code> parameter is optional. If you ignore it, you&#39;re just writing an end-point that will ignore anything after it in the middleware chain. Simply not calling <code>next</code> is a way of ending the chain.</p>

<p>What if I don’t want <em>every</em> request to be logged? Bogart lets you target middleware to specific routes.</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>router</span><span class='p'>.</span><span class='nx'>get</span><span class='p'>(</span><span class='s1'>&#39;/&#39;</span><span class='p'>,</span> <span class='nx'>LogRequest</span><span class='p'>,</span> <span class='kd'>function</span> <span class='p'>(</span><span class='nx'>req</span><span class='p'>)</span> <span class='p'>{</span>
  <span class='k'>return</span> <span class='p'>{</span>
    <span class='nx'>status</span><span class='o'>:</span> <span class='mi'>200</span><span class='p'>,</span>
    <span class='nx'>headers</span><span class='o'>:</span> <span class='p'>{</span> <span class='s1'>&#39;content-type&#39;</span><span class='o'>:</span> <span class='s1'>&#39;text/plain&#39;</span> <span class='p'>},</span>
    <span class='nx'>body</span><span class='o'>:</span> <span class='s1'>&#39;Hello World&#39;</span>
  <span class='p'>};</span>      
<span class='p'>});</span>
</code></pre></div>
<p>You can provide as many middleware functions as you want to the router verb methods.</p>

<h1 id="views">Views</h1>

<p>Most Bogart appications will want to use some templating and not just return hand-built resuilt from routes. Bogart comes with a <code>ViewEngine</code> that makes this easier. The <code>ViewEngine</code> is an abstraction around templating languages with support for layouts and partials.</p>

<p>Bogart comes with Mustache by default. Other view engines may be added via the plugin mechanism.</p>

<p>So how do we use the view engine?</p>

<p>Add the following in app.js:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>viewEngine</span> <span class='o'>=</span> <span class='nx'>bogart</span><span class='p'>.</span><span class='nx'>viewEngine</span><span class='p'>(</span><span class='s1'>&#39;mustache&#39;</span><span class='p'>);</span>

<span class='nx'>router</span><span class='p'>.</span><span class='nx'>get</span><span class='p'>(</span><span class='s1'>&#39;/mustache-rocks&#39;</span><span class='p'>,</span> <span class='kd'>function</span> <span class='p'>(</span><span class='nx'>req</span><span class='p'>)</span> <span class='p'>{</span>
  <span class='kd'>var</span> <span class='nx'>body</span> <span class='o'>=</span> <span class='nx'>viewEngine</span><span class='p'>.</span><span class='nx'>render</span><span class='p'>(</span><span class='s1'>&#39;mustache-rocks.html&#39;</span><span class='p'>,</span> <span class='p'>{</span>
    <span class='nx'>locals</span><span class='o'>:</span> <span class='p'>{</span>
      <span class='nx'>title</span><span class='o'>:</span> <span class='s1'>&#39;Hello View Engine&#39;</span>
    <span class='p'>}</span>
  <span class='p'>});</span>

  <span class='k'>return</span> <span class='p'>{</span>
    <span class='nx'>status</span><span class='o'>:</span> <span class='mi'>200</span><span class='p'>,</span>
    <span class='nx'>headers</span><span class='o'>:</span> <span class='p'>{</span> <span class='s1'>&#39;content-type&#39;</span><span class='o'>:</span> <span class='s1'>&#39;text/html&#39;</span> <span class='p'>},</span>
    <span class='nx'>body</span><span class='o'>:</span> <span class='nx'>body</span>
  <span class='p'>};</span>
<span class='p'>});</span>
</code></pre></div>
<p>Create a <code>views/mustache-rocks.html</code> file:</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;h1&gt;</span>Mustache Rocks!<span class='nt'>&lt;/h1&gt;</span>
<span class='nt'>&lt;p&gt;&lt;/p&gt;</span>
</code></pre></div>
<p>Create a <code>views/layout.html</code> file:</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;html&gt;</span>
<span class='nt'>&lt;head&gt;</span>
  <span class='nt'>&lt;title&gt;</span>{{title}}<span class='nt'>&lt;/title&gt;</span>
<span class='nt'>&lt;/head&gt;</span>
<span class='nt'>&lt;body&gt;</span>
  {{{body}}}
<span class='nt'>&lt;/body&gt;</span>
</code></pre></div>
<p>What have we here? The <code>layout.html</code> file contains markup that is to be reused for many pages. The <code>title</code> variable is provided from the <code>locals</code> property in the call to <code>viewEngine.render</code>. The <code>body</code> variable is special. It will contain the rendered code from <code>index.html</code>. Note how we use <code>title</code> in both <code>index.html</code> and in <code>layout.html</code>. Also note how a triple mustache is used for <code>body</code>. This is because the <code>body</code> variable already contains HTML escaped code and so does not need to be HTML escaped again. The triple mustache tells mustache not to re-HTML escape it.</p>

<p>You can find the source code for these examples at <a href="http://github.com/nrstott/hello-bogart">github</a>.</p>

<p>For more Bogart fun, check out the <a href="/docs/index.html">API Docs</a> or more <a href="/tutorials/index.html">tutorials</a>.</p>

<p>Have a question? <a href="mailto:nrstott@gmail.com">Email me</a>.</p>

  <script src="//code.jquery.com/jquery.js"></script>
  <script src="/bogart/js/bootstrap.min.js"></script>
</body>
</html>